!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i(require("long"));else if("function"==typeof define&&define.amd)define(["long"],i);else{var n="object"==typeof exports?i(require("long")):i(t.long);for(var e in n)("object"==typeof exports?exports:t)[e]=n[e]}}("undefined"!=typeof self?self:this,(function(t){return function(){"use strict";var i={8899:function(t,i,n){var e,r,o,s;n.d(i,{UF:function(){return o},eI:function(){return e},ju:function(){return s},kf:function(){return r}}),function(t){t[t.Off=0]="Off",t[t.TurningOn=1]="TurningOn",t[t.On=2]="On"}(e||(e={})),function(t){t[t.World=0]="World",t[t.Team=1]="Team",t[t.SecretTeam=2]="SecretTeam"}(r||(r={})),function(t){t[t.All=0]="All",t[t.World=1]="World",t[t.Team=2]="Team"}(o||(o={})),function(t){t[t.All=0]="All",t[t.World=1]="World",t[t.Team=2]="Team"}(s||(s={}))},166:function(t,i,n){var e,r,o,s;n.d(i,{PP:function(){return s}}),function(t){t[t.NONE=0]="NONE",t[t.MEN_TO_CHILD=1]="MEN_TO_CHILD",t[t.MEN_TO_WOMEN=2]="MEN_TO_WOMEN",t[t.WOMEN_TO_CHILD=3]="WOMEN_TO_CHILD",t[t.WOMEN_TO_MEN=4]="WOMEN_TO_MEN",t[t.FOREIGNER=5]="FOREIGNER",t[t.OPTIMUS_PRIME=6]="OPTIMUS_PRIME",t[t.ANDROID=7]="ANDROID",t[t.ETHEREAL=8]="ETHEREAL",t[t.MALE_MAGNETIC=9]="MALE_MAGNETIC",t[t.FEMALE_FRESH=10]="FEMALE_FRESH",t[t.MAJOR_C=11]="MAJOR_C",t[t.MINOR_A=12]="MINOR_A",t[t.HARMONIC_MINOR=13]="HARMONIC_MINOR",t[t.FEMALE_ENERGETIC=14]="FEMALE_ENERGETIC",t[t.RICHNESS=15]="RICHNESS",t[t.MUFFLED=16]="MUFFLED",t[t.ROUNDNESS=17]="ROUNDNESS",t[t.FALSETTO=18]="FALSETTO",t[t.FULLNESS=19]="FULLNESS",t[t.CLEAR=20]="CLEAR",t[t.HIGHLY_RESONANT=21]="HIGHLY_RESONANT",t[t.LOUD_CLEAR=22]="LOUD_CLEAR"}(e||(e={})),function(t){t[t.None=0]="None",t[t.SoftRoom=1]="SoftRoom",t[t.LargeRoom=2]="LargeRoom",t[t.ConcertHall=3]="ConcertHall",t[t.Valley=4]="Valley",t[t.RecordingStudio=5]="RecordingStudio",t[t.Basement=6]="Basement",t[t.KTV=7]="KTV",t[t.Popular=8]="Popular",t[t.Rock=9]="Rock",t[t.VocalConcert=10]="VocalConcert",t[t.GramoPhone=11]="GramoPhone",t[t.EnhancedKTV=12]="EnhancedKTV"}(r||(r={})),function(t){t[t.None=0]="None",t[t.Local=1]="Local",t[t.Publish=2]="Publish",t[t.All=3]="All"}(o||(o={})),function(t){t[t.AI=0]="AI",t[t.AIBalanced=1]="AIBalanced"}(s||(s={}))},8627:function(t,i,n){n(8866)},8866:function(t,i,n){n.d(i,{Rl:function(){return l},VJ:function(){return r},Wk:function(){return f},aw:function(){return u},dO:function(){return h},fT:function(){return o},h2:function(){return c},l3:function(){return e},pt:function(){return s},qC:function(){return a}});n(8627),n(6994);var e=Promise,r=document;var o="room not exist",s="device is not found",u="stream is not from zego",h="input param error",a="local stream wrong",c="no preview",f="publish stream no found",l="network is broken"},4872:function(t,i,n){function e(t){return"number"==typeof t}function r(t){return"string"==typeof t}function o(t){return"boolean"==typeof t}function s(t){return void 0===t}function u(t){return"function"==typeof t}function h(t){return t instanceof HTMLMediaElement}n.d(i,{Cs:function(){return e},JO:function(){return u},QP:function(){return r},Si:function(){return h},TE:function(){return s},dd:function(){return o}})},6493:function(t,i,n){function e(){return navigator.userAgent||""}function r(){var t,i=navigator.userAgent,n=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(n[1])?{name:"IE",version:(t=/\brv[ :]+([\d\.]+)/g.exec(i)||[])[1]||""}:"Chrome"===n[1]&&null!=(t=i.match(/\bOPR|Edge\/([\d\.]+)/))?{name:"Opera",version:t[1]}:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=i.match(/version\/([\d+\.]+)/i))&&n.splice(1,1,t[1]),{name:n[0],version:n[1]})}function o(){return"chrome"==r().name.toLowerCase()}function s(){var t=e();return!!(t.match(/Mobi/i)||t.match(/Android/i)||t.match(/iPhone/i))}n.d(i,{$t:function(){return e},Fr:function(){return s},H8:function(){return o}})},6994:function(i){i.exports=t}},n={};function e(t){var r=n[t];if(void 0!==r)return r.exports;var o=n[t]={exports:{}};return i[t](o,o.exports,e),o.exports}e.d=function(t,i){for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return function(){e.r(r),e.d(r,{RangeAudio:function(){return Z}});var t=e(8899),i=e(8866),n=function(){function t(){}return t.generateEls=function(t){if(void 0===t&&(t=30),this.elements.length>=t)this.elements.forEach((function(t){t.dom.play().catch((function(t){}))}));else{var n=Array(t-this.elements.length).fill(0).map((function(t,n){var e=i.VJ.createElement("audio");return e.muted=!0,e.setAttribute("autoplay","autoplay"),e.setAttribute("playsInline","playsInline"),e.id="audio"+n,{dom:e,id:n,used:!1}}));this.elements=this.elements.concat(n)}},t.useAudioEl=function(){0===this.elements.length&&this.generateEls();var t=this.elements.find((function(t){return!t.used}));return t&&(t.used=!0),t},t.stopUsingAudioEl=function(t){var i=this.elements[t];i&&(i.dom.onpause=null,i.dom.onerror=null,i.dom.muted=!0,i.used=!1)},t.elements=[],t}(),o=function(t,i,n,e){return new(n||(n=Promise))((function(r,o){function s(t){try{h(e.next(t))}catch(t){o(t)}}function u(t){try{h(e.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?r(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(s,u)}h((e=e.apply(t,i||[])).next())}))},s=function(t,i){var n,e,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,e&&(r=2&u[0]?e.return:u[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,u[1])).done)return r;switch(e=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,e=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){s.label=u[1];break}if(6===u[0]&&s.label<r[1]){s.label=r[1],r=u;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(u);break}r[2]&&s.ops.pop(),s.trys.pop();continue}u=i.call(t,s)}catch(t){u=[6,t],e=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},u="zc.ra.3",h=function(){function t(t,i){this.t=t,this.i=i,this.rtcConn=null,this.loopbackConn=null,this.destStream=new MediaStream,this.onError=null}return t.prototype.bindStream=function(t,i){var n,e;return o(this,void 0,void 0,(function(){var r,o,h,a,c,f,l=this;return s(this,(function(s){switch(s.label){case 0:return i&&(this.t=i),r=["completed","connected"],this.rtcConn&&this.loopbackConn&&r.includes(this.rtcConn.connectionState)?(o=null===(n=this.rtcConn)||void 0===n?void 0:n.getSenders().find((function(t){var i;return"audio"===(null===(i=t.track)||void 0===i?void 0:i.kind)})),t.getTracks().forEach((function(t){"audio"===t.kind&&(null==o||o.replaceTrack(t))})),[3,10]):[3,1];case 1:this.rtcConn=new RTCPeerConnection,this.loopbackConn=new RTCPeerConnection,h={offerVideo:!0,offerAudio:!0,offerToReceiveAudio:!1,offerToReceiveVideo:!1},this.rtcConn.onicecandidateerror=function(t){l.i.warn(u+" ".concat(l.t," loopback in ice error: ").concat(JSON.stringify(t)))},this.loopbackConn.onicecandidateerror=function(t){l.i.warn(u+" ".concat(l.t," loopback out ice error: ").concat(JSON.stringify(t)))},this.rtcConn.onicecandidate=function(t){var i,n=t.candidate;n&&(l.i.info(u+" ".concat(l.t," loopback add out candidate: ").concat(n)),null===(i=l.loopbackConn)||void 0===i||i.addIceCandidate(new RTCIceCandidate(n)))},this.loopbackConn.onicecandidate=function(t){var i,n=t.candidate;n&&(l.i.info(u+" ".concat(l.t," loopback add in candidate: ").concat(n)),null===(i=l.rtcConn)||void 0===i||i.addIceCandidate(new RTCIceCandidate(n)))},window.setTimeout((function(){l.rtcConn&&l.loopbackConn&&(r.includes(l.rtcConn.iceConnectionState)&&r.includes(l.loopbackConn.iceConnectionState)?l.i.info(u+" ".concat(l.t," loopback connect ok.")):(l.i.warn(u+" ".concat(l.t," loopback connect failed. in state: ").concat(l.rtcConn.iceConnectionState,", out state: ").concat(l.loopbackConn.iceConnectionState)),l.close(),l.onError&&l.onError("time out")))}),2e3),this.loopbackConn.ontrack=function(t){var i=t.track;l.i.info(u+" ".concat(l.t," loopback receive track")),l.replaceTrack(i)},t.getTracks().find((function(i){var n;if("audio"===i.kind)return null===(n=l.rtcConn)||void 0===n||n.addTrack(i,t),!0})),s.label=2;case 2:return s.trys.push([2,9,,10]),[4,this.rtcConn.createOffer(h)];case 3:return a=s.sent(),[4,this.rtcConn.setLocalDescription(a)];case 4:return s.sent(),[4,this.loopbackConn.setRemoteDescription(a)];case 5:return s.sent(),[4,this.loopbackConn.createAnswer()];case 6:return(c=s.sent()).sdp=null===(e=c.sdp)||void 0===e?void 0:e.replace(/useinbandfec=/,"stereo=1;useinbandfec="),[4,this.loopbackConn.setLocalDescription(c)];case 7:return s.sent(),[4,this.rtcConn.setRemoteDescription(c)];case 8:return s.sent(),this.i.info(u+" ".concat(this.t," loopback set sdp completed.")),[3,10];case 9:return f=s.sent(),this.i.error(u+" ".concat(this.t," loopback connect failed.").concat(f)),this.close(),this.onError&&this.onError("connect failed"),this.onError=null,[3,10];case 10:return[2,this.destStream]}}))}))},t.prototype.replaceTrack=function(t){var i=this;"audio"===t.kind&&(this.destStream.getTracks().forEach((function(t){i.destStream.removeTrack(t)})),this.destStream.addTrack(t))},t.prototype.close=function(){var t=this,i=this.rtcConn,n=this.loopbackConn;this.destStream.getTracks().forEach((function(i){t.destStream.removeTrack(i)})),null==i||i.close(),null==n||n.close(),this.rtcConn=null,this.loopbackConn=null},t}();var a=e(4872),c=e(6493),f=function(t,i,n,e){return new(n||(n=Promise))((function(r,o){function s(t){try{h(e.next(t))}catch(t){o(t)}}function u(t){try{h(e.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?r(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(s,u)}h((e=e.apply(t,i||[])).next())}))},l=function(t,i){var n,e,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,e&&(r=2&u[0]?e.return:u[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,u[1])).done)return r;switch(e=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,e=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){s.label=u[1];break}if(6===u[0]&&s.label<r[1]){s.label=r[1],r=u;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(u);break}r[2]&&s.ops.pop(),s.trys.pop();continue}u=i.call(t,s)}catch(t){u=[6,t],e=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},d="zc.ra.5";var v,p=function(){function t(t,i){this.i=t,this.userID="base"+(new Date).getTime(),this.isHide=!1,this.distance=null,this.maxDistance=1e3,this.position=null,this.speaker="",this.audioEl=null,this.sourceNode=null,this.isPlaying=!1,this.config={needLoopback:!0,useGain:!0,playOnAudioContext:!1,useWebAudio:!0},this.volume=1,this.gainNode=null,this.isSpatial=!1,this.panner=null,this.audioCtx=i.audioCtx,this.isSpatial=i.isSpatial,this.setMaxDistance((0,a.Cs)(i.maxDistance)?i.maxDistance:1e5),this.destNode=this.audioCtx.createMediaStreamDestination(),this.setVolume(i.volume),this.setSpeaker(i.speaker).catch((function(t){})),this.inBackground(i.isHide)}return t.prototype.setPosition=function(t){this.i.info(d+" ".concat(this.userID," set position: ")+t),this.position=t,this.panner&&(void 0!==this.panner.positionX?(this.panner.positionX.value=t[1],this.panner.positionY.value=t[2],this.panner.positionZ.value=-t[0]):this.panner.setPosition(t[1],t[2],-t[0]))},t.prototype.getDistanceFromListener=function(t){return this.distance=function(t,i){if(!i||!t)return null;var n=[t[0]-i[0],t[1]-i[1],t[2]-i[2]];return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2))}(this.position,t.position),this.distance},t.prototype.setMaxDistance=function(t){this.maxDistance=t,this.panner&&(t<10&&(t=10),this.panner.maxDistance=2.6*t)},t.prototype.setVolume=function(t){isNaN(t)||(this.volume=t,this.gainNode&&(this.gainNode.gain.value=this.volume))},t.prototype.setSpeaker=function(t){var i;return f(this,void 0,void 0,(function(){var n,e,r;return l(this,(function(o){switch(o.label){case 0:if(!(0,a.QP)(t))return[2];if(this.speaker=t,!(n=null===(i=this.audioEl)||void 0===i?void 0:i.dom))return[3,10];if(!(e=n.setSinkId))return[3,8];o.label=1;case 1:return o.trys.push([1,6,,7]),this.config.playOnAudioContext?[3,3]:[4,e.call(n,t||"")];case 2:return o.sent(),[3,5];case 3:return[4,e.call(n,"")];case 4:o.sent(),o.label=5;case 5:return this.i.info(d+" ".concat(this.userID," set speaker success. id: ").concat(t,".")),[3,7];case 6:throw r=o.sent(),this.i.error(d+" ".concat(this.userID," set speaker failed. id: ").concat(t,"  error: ").concat(r,".")),r;case 7:return[3,9];case 8:throw"setting speaker not support.";case 9:return[3,11];case 10:this.i.info(d+" ".concat(this.userID," no element for set speaker.")),o.label=11;case 11:return[2]}}))}))},t.prototype.initPanner=function(){if(!this.panner){var t=function(t,i,n){var e=n||[0,0,0],r=t.createPanner(),o=t.createGain();return r.panningModel="HRTF",r.distanceModel="linear",r.refDistance=1,r.maxDistance=2.6*i||1,r.rolloffFactor=1,r.coneOuterGain=.4,void 0!==r.positionX?(r.positionX.value=e[1],r.positionY.value=e[2],r.positionZ.value=-e[0]):r.setPosition(e[1],e[2],-e[0]),{panner:r,gainNode:o}}(this.audioCtx,this.maxDistance,this.position),i=t.gainNode;this.panner=t.panner,this.gainNode=i,i.gain.value=this.volume}},t.prototype.changeRenderConfig=function(t,i,n,e){var r,o,s,u,a;return void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===e&&(e=!0),f(this,void 0,void 0,(function(){var f,v,p,w,m,y,b,g,E,k,S,x,O=this;return l(this,(function(l){switch(l.label){case 0:return i||this.isSpatial!==t?(this.isSpatial=t,f=(0,c.H8)()&&(0,c.Fr)(),[4,B()]):[2];case 1:return v=l.sent(),p="Windows"===v.platform&&v.majorPlatformVersion>=13,w=this.isHide&&(p||f),m="running"!==this.audioCtx.state,e&&(w||m)&&(this.i.warn("".concat(d," ").concat(this.userID," stop web audio. system: ").concat(v.platform," ").concat(v.majorPlatformVersion)),e=!1),this.config.useWebAudio=e,y=(0,c.$t)(),b=y.includes("safari")&&!y.includes("chrome"),g=y.includes("micromessenger")&&new RegExp(/(iphone|ipad|ipod|ios)/i).test(y),e||this.stream||(n=!0),this.config.playOnAudioContext=n,this.initPanner(),this.isPlaying&&this.sourceNode?(this.lastNode&&this.lastNode.disconnect(),E=this.sourceNode,this.sourceNode.disconnect(),null===(r=this.panner)||void 0===r||r.disconnect(),null===(o=this.gainNode)||void 0===o||o.disconnect(),this.gainNode?(e&&(this.config.useGain&&(E=this.sourceNode.connect(this.gainNode)),this.panner&&t&&(E=E.connect(this.panner))),E.connect(n?this.audioCtx.destination:this.destNode),this.lastNode=E,this.position&&this.setPosition(this.position),this.i.info(d+" '".concat(this.userID,"' play ").concat(t?"3d":"normal"," stream on ").concat(n?"audio ctx":"element")),(k=null===(s=this.audioEl)||void 0===s?void 0:s.dom)?(k.onpause=function(){O.i.warn(d+" ".concat(O.streamID," audio paused"))},k.onerror=function(t){O.i.warn(d+" ".concat(O.streamID," audio error, ").concat(t))},n?(this.stream&&k.srcObject!==this.stream&&(k.srcObject=this.stream,k.muted=!0,k.oncanplay=function(){k.play().then((function(){O.i.info(d+" ".concat(O.userID," ctx autoplay success.")),O.checkPlayStatus()})).catch((function(t){O.i.warn(d+" ".concat(O.userID," ctx autoplay failed."))}))}),[3,6]):[3,2]):[3,6]):[3,6]):[3,6];case 2:return S=this.destNode.stream,(x=this.config.needLoopback&&!g&&!b)&&this.loopbackConn&&(this.loopbackConn.close(),this.loopbackConn.onError=null),e||!this.stream?[3,3]:(this.i.info("".concat(d," ").concat(this.userID," stop audio api")),this.sourceNode.disconnect(),null===(u=this.panner)||void 0===u||u.disconnect(),null===(a=this.gainNode)||void 0===a||a.disconnect(),S=this.stream,[3,5]);case 3:return x&&S?(this.loopbackConn=this.loopbackConn||new h(this.streamID||"",this.i),this.loopbackConn.onError=function(t){O.i.warn(d+" ".concat(O.userID," loopback failed! ").concat(t)),O.changeRenderConfig(O.isSpatial,!0,!0)},[4,this.loopbackConn.bindStream(S,this.streamID||void 0)]):[3,5];case 4:return S=l.sent(),[3,5];case 5:k.muted=!0,k.srcObject=S,this.setSpeaker(this.speaker).catch((function(t){})),k.oncanplay=function(){if(k){k.muted=!1;var t=function(t){O.i.error(d+" ".concat(O.userID," autoplay failed. error: ").concat(t)),O.changeRenderConfig(O.isSpatial,!0,!0)};k.play().then((function(){(null==k?void 0:k.paused)?t("audio paused"):(O.i.info(d+" ".concat(O.userID," element autoplay success.")),O.checkPlayStatus())})).catch((function(i){t(i)}))}},l.label=6;case 6:return[2]}}))}))},t.prototype.checkPlayStatus=function(){var t=this;setTimeout((function(){var i;if(t.isPlaying){var n=null===(i=t.audioEl)||void 0===i?void 0:i.dom,e=t.audioCtx.state;!n||n.paused||n.muted&&!t.config.playOnAudioContext||"running"!==e?(t.i.warn("".concat(d," ").concat(t.userID," play detection is abnormal. audio ctx:").concat(e,", paused:").concat(null==n?void 0:n.paused,", muted:").concat(null==n?void 0:n.muted)),"running"!==e&&(t.audioCtx.resume(),setTimeout((function(){t.i.warn("".concat(d," ").concat(t.userID," play resume. audio ctx:").concat(e,", paused:").concat(null==n?void 0:n.paused,", muted:").concat(null==n?void 0:n.muted))}),1e3))):t.i.info("".concat(d," ").concat(t.userID," play detection is fine"))}}),2e3)},t.prototype.inBackground=function(t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),this.isHide!==t&&(this.isHide=t,t||this.config.useWebAudio||this.changeRenderConfig(this.isSpatial,!0))},t}(),w=(v=function(t,i){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},v(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}v(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}),m=function(t,i,n,e){return new(n||(n=Promise))((function(r,o){function s(t){try{h(e.next(t))}catch(t){o(t)}}function u(t){try{h(e.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?r(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(s,u)}h((e=e.apply(t,i||[])).next())}))},y=function(t,i){var n,e,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,e&&(r=2&u[0]?e.return:u[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,u[1])).done)return r;switch(e=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,e=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){s.label=u[1];break}if(6===u[0]&&s.label<r[1]){s.label=r[1],r=u;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(u);break}r[2]&&s.ops.pop(),s.trys.pop();continue}u=i.call(t,s)}catch(t){u=[6,t],e=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},b="zc.ra.1",g=function(e){function r(i,n,r){var o=e.call(this,i,r)||this;return o.i=i,o.audioTrack=null,o.zegoRTC=r.zegoRTC,o.userID=n.userID,o.teamID=n.teamID,o.raMode=void 0!==n.raMode?n.raMode:t.kf.World,n.position&&(o.position=n.position),o}return w(r,e),Object.defineProperty(r.prototype,"sendMode",{get:function(){return void 0!==this._sendMode?this._sendMode:this.raMode===t.kf.World?t.UF.All:t.UF.Team},set:function(t){this._sendMode=t},enumerable:!1,configurable:!0}),r.prototype.checkTrackChanged=function(){var t;if(this.stream){var i=this.stream.getAudioTracks()[0];i&&i!==this.audioTrack&&(this.i.info(b+" retry play success, render stream."),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.sourceNode=this.audioCtx.createMediaStreamSource(this.stream),this.changeRenderConfig(this.isSpatial,!0),this.audioTrack=i)}},r.prototype.startPlayingAudio=function(t){var e,r;return m(this,void 0,void 0,(function(){var o,s,u;return y(this,(function(h){switch(h.label){case 0:if(!this.streamID)return[2];h.label=1;case 1:return h.trys.push([1,3,,4]),t&&this.i.info(b+" ".concat(this.streamID," ")+t),this.isPlaying=!0,o=this,[4,this.zegoRTC.startPlayingStream(this.streamID)];case 2:return o.stream=h.sent(),this.audioTrack=this.stream.getAudioTracks()[0],[3,4];case 3:if(s=h.sent(),this.isPlaying=!1,1103049===s.code)return[2];throw s;case 4:return this.audioEl=this.audioEl||n.useAudioEl()||null,this.i.info(b+" ".concat(this.streamID," start using audio el ").concat(null===(e=this.audioEl)||void 0===e?void 0:e.id)),(u=null===(r=this.audioEl)||void 0===r?void 0:r.dom)||(this.i.error(b+" not enough audio elements"),u=i.VJ.createElement("audio"),this.audioEl={id:-1,dom:u,used:!0},u.setAttribute("autoplay","autoplay")),u.muted=!0,this.stream&&(this.sourceNode=this.audioCtx.createMediaStreamSource(this.stream)),this.sourceNode?[4,this.changeRenderConfig(this.isSpatial,!0)]:[3,6];case 5:h.sent(),h.label=6;case 6:return"suspended"===this.audioCtx.state&&this.audioCtx.resume(),[2]}}))}))},r.prototype.stopPlayingAudio=function(t){this.isPlaying&&this.streamID?(this.i.info(b+" ".concat(this.streamID," ")+t),this.zegoRTC.stopPlayingStream(this.streamID),this.isPlaying=!1):this.streamID&&this.i.info(b+" ".concat(this.streamID," not playing, ")+t),this.stream=void 0,this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null);var i=this.audioEl,e=null==i?void 0:i.dom;e&&(e.srcObject=null,e.parentNode&&e.parentNode.removeChild(e));var r=(null==i?void 0:i.id)||-1;i&&r>=0&&(n.stopUsingAudioEl(r),this.i.info(b+" ".concat(this.streamID," stop using audio el ").concat(r))),this.audioEl=null,this.loopbackConn&&(this.loopbackConn.close(),this.loopbackConn.onError=null)},r.prototype.isSpeakInTeam=function(i){var n=![this.teamID,i].includes(void 0)&&""!==this.teamID&&this.teamID===i,e=[t.UF.Team,t.UF.All].includes(this.sendMode);return n&&e},r}(p),E=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),k=function(t,i,n,e){return new(n||(n=Promise))((function(r,o){function s(t){try{h(e.next(t))}catch(t){o(t)}}function u(t){try{h(e.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?r(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(s,u)}h((e=e.apply(t,i||[])).next())}))},S=function(t,i){var n,e,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,e&&(r=2&u[0]?e.return:u[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,u[1])).done)return r;switch(e=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,e=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){s.label=u[1];break}if(6===u[0]&&s.label<r[1]){s.label=r[1],r=u;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(u);break}r[2]&&s.ops.pop(),s.trys.pop();continue}u=i.call(t,s)}catch(t){u=[6,t],e=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},x="zc.ra.4",O=function(t){function e(i,n,e){var r=t.call(this,i,e)||this;return r.i=i,r.media=n.media,r.position=n.position||null,r.createSource(),r.userID="custom"+(new Date).getTime(),r.config={needLoopback:!1,useGain:!1,playOnAudioContext:!1,useWebAudio:!0},r}return E(e,t),e.prototype.createSource=function(){var t=this;if((0,c.Fr)())return this.i.info("".concat((0,c.Fr)()," ").concat(this.userID," not create src.")),void(this.changeRenderConfig=function(){return k(t,void 0,void 0,(function(){return S(this,(function(t){return[2]}))}))});this.media&&(this.i.info(x+" create el source."),this.sourceNode||(this.sourceNode=this.audioCtx.createMediaElementSource(this.media)),null!==this.distance&&this.distance<this.maxDistance&&this.startPlayingAudio("in range"))},e.prototype.startPlayingAudio=function(t){var e,r;return k(this,void 0,void 0,(function(){var o;return S(this,(function(s){switch(s.label){case 0:return this.isPlaying?(this.i.info(x+" ".concat(this.userID," is already playing")),[2]):(t&&this.i.info(x+" vocal ".concat(this.userID," play for ").concat(t)),this.isPlaying=!0,(0,c.Fr)()?(this.media.muted=!1,[2]):(this.audioEl=this.audioEl||n.useAudioEl()||null,this.i.info(x+" ".concat(this.userID," start using audio el ").concat(null===(e=this.audioEl)||void 0===e?void 0:e.id)),(o=null===(r=this.audioEl)||void 0===r?void 0:r.dom)||(this.i.error(x+" ".concat(this.userID," not enough audio elements")),o=i.VJ.createElement("audio"),this.audioEl={id:-1,dom:o,used:!0},o.setAttribute("autoplay","autoplay")),o.muted=!0,o.setAttribute("autoplay","autoplay"),o.setAttribute("id","zg-audio-source-"+this.userID),this.sourceNode?[4,this.changeRenderConfig(this.isSpatial,!0)]:[3,2]));case 1:s.sent(),s.label=2;case 2:return"suspended"===this.audioCtx.state&&this.audioCtx.resume(),[2]}}))}))},e.prototype.stopPlayingAudio=function(t){if(void 0===t&&(t=""),this.isPlaying&&(this.i.info(x+" vocal ".concat(this.userID," stop for ")+t),this.isPlaying=!1),(0,c.Fr)())this.media.muted=!0;else{this.sourceNode&&this.sourceNode.disconnect();var i=this.audioEl,e=null==i?void 0:i.dom;e&&(e.srcObject=null,e.parentNode&&e.parentNode.removeChild(e));var r=(null==i?void 0:i.id)||-1;i&&r>=0&&(n.stopUsingAudioEl(r),this.i.info(x+" ".concat(this.userID," stop using audio el ").concat(r))),this.audioEl=null}},e.prototype.checkIfCanPlay=function(t){var i=this.distance=this.getDistanceFromListener(t);null===i||i>this.maxDistance||0===this.maxDistance?this.stopPlayingAudio("out of range. ".concat(i," > ").concat(this.maxDistance)):this.startPlayingAudio("in range")},e}(p),A=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),T=function(t,i,n,e){return new(n||(n=Promise))((function(r,o){function s(t){try{h(e.next(t))}catch(t){o(t)}}function u(t){try{h(e.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?r(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(s,u)}h((e=e.apply(t,i||[])).next())}))},N=function(t,i){var n,e,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,e&&(r=2&u[0]?e.return:u[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,u[1])).done)return r;switch(e=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,e=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){s.label=u[1];break}if(6===u[0]&&s.label<r[1]){s.label=r[1],r=u;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(u);break}r[2]&&s.ops.pop(),s.trys.pop();continue}u=i.call(t,s)}catch(t){u=[6,t],e=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},_="zc.ra.4",R=function(t){function e(i,n,e){var r=t.call(this,i,e)||this;return r.i=i,r.streamView=n.streamView,r.position=n.position||null,r.createSource(),r.userID="stream"+(new Date).getTime(),r.config={needLoopback:!1,useGain:!1,playOnAudioContext:!1,useWebAudio:!0},r.streamView.on("_trackChange",(function(t,i){"audio"===t&&(i?r.createSource(!0):r.i.error("".concat(_," ").concat(r.userID," audio track lost")))})),r}return A(e,t),e.prototype.createSource=function(t){var i=this;if(void 0===t&&(t=!1),(0,c.Fr)())return this.i.info("".concat(_," ").concat(this.userID," not create src.")),this.changeRenderConfig=function(){return T(i,void 0,void 0,(function(){return N(this,(function(t){return[2]}))}))},!1;if(!this.streamView)return!1;if(this.i.info(_+" create view source. trackChanged: "+t),!this.sourceNode||t){var n=this.streamView.v.getAudioNodeAndStopRender();if(!n)return this.i.error(_+" create view source failed."),!1;this.sourceNode&&this.sourceNode.disconnect(),this.sourceNode=n,this.changeRenderConfig(this.isSpatial,!0)}return null!==this.distance&&this.distance<this.maxDistance&&this.startPlayingAudio("in range"),!0},e.prototype.startPlayingAudio=function(t){var e,r;return T(this,void 0,void 0,(function(){var o;return N(this,(function(s){switch(s.label){case 0:return this.isPlaying?(this.i.info(_+" ".concat(this.userID," is already playing")),[2]):(t&&this.i.info(_+" vocal ".concat(this.userID," play for ").concat(t)),this.isPlaying=!0,(0,c.Fr)()?(this.streamView.setAudioMuted(!1),[2]):(this.audioEl=this.audioEl||n.useAudioEl()||null,this.i.info(_+" ".concat(this.userID," start using audio el ").concat(null===(e=this.audioEl)||void 0===e?void 0:e.id)),(o=null===(r=this.audioEl)||void 0===r?void 0:r.dom)||(this.i.error(_+" ".concat(this.userID," not enough audio elements")),o=i.VJ.createElement("audio"),this.audioEl={id:-1,dom:o,used:!0},o.setAttribute("autoplay","autoplay")),o.muted=!0,o.setAttribute("autoplay","autoplay"),o.setAttribute("id","zg-audio-source-"+this.userID),this.sourceNode?[4,this.changeRenderConfig(this.isSpatial,!0)]:[3,2]));case 1:s.sent(),s.label=2;case 2:return"suspended"===this.audioCtx.state&&this.audioCtx.resume(),[2]}}))}))},e.prototype.stopPlayingAudio=function(t){if(void 0===t&&(t=""),this.isPlaying&&(this.i.info(_+" vocal ".concat(this.userID," stop for ")+t),this.isPlaying=!1),(0,c.Fr)())this.streamView.setAudioMuted(!0);else{this.sourceNode&&this.sourceNode.disconnect();var i=this.audioEl,e=null==i?void 0:i.dom;e&&(e.srcObject=null,e.parentNode&&e.parentNode.removeChild(e));var r=(null==i?void 0:i.id)||-1;i&&r>=0&&(n.stopUsingAudioEl(r),this.i.info(_+" ".concat(this.userID," stop using audio el ").concat(r))),this.audioEl=null}},e.prototype.checkIfCanPlay=function(t){var i=this.distance=this.getDistanceFromListener(t);null===i||i>this.maxDistance||0===this.maxDistance?this.stopPlayingAudio("out of range. ".concat(i," > ").concat(this.maxDistance)):this.startPlayingAudio("in range")},e}(p),C=e(166),P=function(){function t(){this.u={}}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.addEventHandler=function(t,i){if(this.u[t]||(this.u[t]=[]),!(0,a.JO)(i))throw new Error("Params callBack is not a Function");return-1==this.u[t].indexOf(i)&&this.u[t].push(i),!0},t.prototype.removeEventHandler=function(t,i){return!!this.u[t]&&(this.u[t]=i?this.u[t].filter((function(t){return t!==i})):[],!0)},t.prototype.emit=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this.u[t]&&this.u[t].forEach((function(n){try{setTimeout((function(){n.apply(void 0,i)}),0)}catch(i){console.error('Fail to execute callback of event "'.concat(t,'" : ').concat(i))}}))},t.prototype.reset=function(){this.u={}},t}(),I=P,M=function(t,i,n,e){return new(n||(n=Promise))((function(r,o){function s(t){try{h(e.next(t))}catch(t){o(t)}}function u(t){try{h(e.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?r(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(s,u)}h((e=e.apply(t,i||[])).next())}))},D=function(t,i){var n,e,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,e&&(r=2&u[0]?e.return:u[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,u[1])).done)return r;switch(e=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,e=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){s.label=u[1];break}if(6===u[0]&&s.label<r[1]){s.label=r[1],r=u;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(u);break}r[2]&&s.ops.pop(),s.trys.pop();continue}u=i.call(t,s)}catch(t){u=[6,t],e=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}};var L,j=function(){function i(i,n){var e=this;this.raMode=t.kf.World,this.recvRange=null,this.position=null,this.forwardAxis=[1,0,0],this.upAxis=[0,0,1],this.audioStream=null,this.enableMic=!1,this.isPublishing=!1,this.streamID=null,this.isDenoise=!1,this.denoiseMode=C.PP.AI,this.voiceChanger=null,this.voiceParam=null,this.isUpdated=!0,this.zegoRTC=n,this.audioCtx=i,this.audioListener=this.audioCtx.listener,this.eventHandler=I.getInstance(),this.zegoRTC.on("publisherStateUpdate",(function(i){var n=i.state,r=i.errorCode,o=i.extendedData,s=i.streamID.match(/(.*)_(.*)/);if(3===(null==s?void 0:s.length)){if(e.userID!==s[1])return;"NO_PUBLISH"===n?(e.isPublishing=!1,e.stopPublishingStream()):(e.isPublishing=!0,e.isUpdated||(e.i.info(b+" resend stream info"),e.updateSteamExtraInfo())),e.eventHandler.emit("microphoneStateUpdate",{NO_PUBLISH:t.eI.Off,PUBLISH_REQUESTING:t.eI.TurningOn,PUBLISHING:t.eI.On}[n],r,o)}})),this.zegoRTC.on("deviceError",(function(t,i){return M(e,void 0,void 0,(function(){var n,e;return D(this,(function(r){switch(r.label){case 0:return this.i.info(b+" device fail ".concat(t," ").concat(i," ").concat(!!this.audioStream," ").concat(this.micID)),this.audioStream?[4,this.zegoRTC.enumDevices()]:[2];case 1:return n=r.sent(),e=n.microphones,this.micID||0!==e.length?1106009!==t?[3,3]:[4,this.zegoRTC.useAudioDevice(this.audioStream,this.micID||e[0].deviceID)]:[2];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}))}return Object.defineProperty(i.prototype,"recvMode",{get:function(){return void 0!==this._recvMode?this._recvMode:[t.kf.World,t.kf.SecretTeam].includes(this.raMode)?t.ju.All:t.ju.Team},set:function(t){this._recvMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sendMode",{get:function(){return void 0!==this._sendMode?this._sendMode:this.raMode===t.kf.World?t.UF.All:t.UF.Team},set:function(t){this._sendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"i",{get:function(){return this.zegoRTC.logger},enumerable:!1,configurable:!0}),i.getInstance=function(t,n){return i.instance||(i.instance=new i(t,n)),i.instance},i.prototype.updateSelfPosition=function(t,i,n){this.position=t,this.forwardAxis=i,Array.isArray(n)&&(this.upAxis=n),this.updateListenerEffect()},i.prototype.updateListenerEffect=function(){this.position&&(this.audioListener.positionX?(this.audioListener.positionX.value=this.position[1],this.audioListener.positionY.value=this.position[2],this.audioListener.positionZ.value=-this.position[0]):this.audioListener.setPosition(this.position[1],this.position[2],-this.position[0]),this.audioListener.forwardX?(this.audioListener.forwardX.value=this.forwardAxis[1],this.audioListener.forwardY.value=this.forwardAxis[2],this.audioListener.forwardZ.value=-this.forwardAxis[0],this.audioListener.upX.value=this.upAxis[1],this.audioListener.upY.value=this.upAxis[2],this.audioListener.upZ.value=-this.upAxis[0]):this.audioListener.setOrientation(this.forwardAxis[1],this.forwardAxis[2],-this.forwardAxis[0],this.upAxis[1],this.upAxis[2],-this.upAxis[0]))},i.prototype.startPublishingStream=function(){var t=this;this.enableMic?this.i.warn(b+" mic is already enabled"):(this.enableMic=!0,this.zegoRTC.createStream({camera:{video:!1,audio:!0,audioInput:this.micID||void 0,audioBitrate:30}}).then((function(i){return M(t,void 0,void 0,(function(){return D(this,(function(t){if(!this.userID)throw this.zegoRTC.destroyStream(i),this.enableMic=!1,Error("Enable mic failed. Please log in room first.");return this.audioStream&&this.audioStream!==i&&this.zegoRTC.destroyStream(this.audioStream),this.audioStream=i,this.isDenoise&&(this.enableDenoise(this.isDenoise),this.denoiseMode===C.PP.AIBalanced&&this.setAiDenoiseMode(this.denoiseMode)),null!==this.voiceChanger&&this.setVoiceChangerPreset({voiceChanger:this.voiceChanger}),null!==this.voiceParam&&this.setVoiceChangerPreset({voiceParam:this.voiceParam}),this.streamID=this.userID+"_"+Date.now(),this.zegoRTC.startPublishingStream(this.streamID,i,{extraInfo:JSON.stringify(this.getExtraInfo())}),[2]}))}))})).catch((function(i){throw t.audioStream=null,t.enableMic=!1,i})))},i.prototype.stopPublishingStream=function(){this.isPublishing&&this.streamID&&this.zegoRTC.stopPublishingStream(this.streamID),this.isPublishing=!1,this.audioStream&&(this.zegoRTC.destroyStream(this.audioStream),this.audioStream=null),this.enableMic=!1},i.prototype.setCustomMode=function(t,i){var n=!1,e=!1,r=!1;return i!==this.recvMode&&(this.recvMode=i,r=!0),t!==this.sendMode&&(this.sendMode=t,n=!0,e=!0),n&&this.updateSteamExtraInfo(),{sendChange:e,recvChange:r}},i.prototype.setNormalMode=function(t){this.raMode=t,this.updateSteamExtraInfo()},i.prototype.setTeamID=function(t){this.teamID=t,this.updateSteamExtraInfo()},i.prototype.updateSteamExtraInfo=function(){var t=this;this.streamID&&this.isPublishing&&(this.isUpdated=!1,this.i.info(b+" update stream info"),this.zegoRTC.setStreamExtraInfo(this.streamID,JSON.stringify(this.getExtraInfo())).then((function(i){0===i.errorCode&&(t.i.info(b+" update stream info success"),t.isUpdated=!0)})))},i.prototype.getExtraInfo=function(){var i,n={range_audio_team_id:this.teamID||"",range_audio_mode:(i=this.raMode,{0:1,1:2,2:3}[i]),r_a_s_flag:1};return void 0===this._sendMode&&this.raMode!==t.kf.World||(n.r_a_speak=this.sendMode),n},i.prototype.reset=function(){this.audioStream&&this.stopPublishingStream(),this.userID=void 0,this.streamID=null},i.prototype.enableDenoise=function(t){var i=this;return this.audioStream&&this.zegoRTC._enableAiDenoise(this.audioStream,t).catch((function(t){i.isDenoise=!1;var n=t||{};i.eventHandler.emit("aiDenoiseError",n.errorCode,n.extendedData)})),this.isDenoise=t,!0},i.prototype.setAiDenoiseMode=function(t){var i=this;return this.audioStream&&this.zegoRTC.setAiDenoiseMode(this.audioStream,t).catch((function(t){i.denoiseMode=C.PP.AI;var n=t||{};i.eventHandler.emit("aiDenoiseError",n.errorCode,n.extendedData)})),this.denoiseMode=t,!0},i.prototype.setVoiceChangerPreset=function(t){var i=this;return this.audioStream&&this.zegoRTC.setVoiceChangerPreset(this.audioStream,t).catch((function(t){i.voiceChanger=null;var n=t||{};i.eventHandler.emit("voiceChangerError",n.errorCode,n.extendedData)})),"voiceChanger"in t&&void 0!==t.voiceChanger?(this.voiceChanger=t.voiceChanger,this.voiceParam=null):"voiceParam"in t&&void 0!==t.voiceParam&&(this.voiceParam=t.voiceParam,this.voiceChanger=null),!0},i}(),F=function(t,i,n){if(n||2===arguments.length)for(var e,r=0,o=i.length;r<o;r++)!e&&r in i||(e||(e=Array.prototype.slice.call(i,0,r)),e[r]=i[r]);return t.concat(e||Array.prototype.slice.call(i))},U="zc.ra.2",G=function(){function i(t,i){this.i=t,this.isEnable=!1,this.interval=100,this.timer=null,this.audioSourceList=[],this.hasChanged=!1,this.userChanged=!1,this.updateUserInterval=1e3,this.updateUserTimer=null,this.audioSourceUpdate=!1,this._maxPlayingQuantity=20,this.allAudioSourceList=[],this.audioSourceWithinRangeList=[],this.localUserList=[],this.h=i}return i.getInstance=function(t,n){return i.instance||(i.instance=new i(t,n)),i.instance},i.prototype.setAudioSourceUpdate=function(t){this.audioSourceUpdate=t},i.prototype.setListener=function(t){this.h=t,this.hasChanged=!0,this.userChanged=!0},i.prototype.setAudioSourceList=function(t){this.audioSourceList=t,this.i.info("".concat(U," set src list: [").concat(t.map((function(t){return t.userID})).join(","),"]")),this.hasChanged=!0},i.prototype.setAllAudioSourceList=function(t){t&&(this.allAudioSourceList=t),this.userChanged=!0},i.prototype.startPlayingAudioStream=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.hasChanged=!0,this.playAudioTask()},i.prototype.playAudioTask=function(){var t=this;this.hasChanged&&(this.hasChanged=!1,this.handlePlayAudioTask()),this.timer=window.setTimeout((function(){t.playAudioTask()}),this.interval)},i.prototype.handlePlayAudioTask=function(){var i=this;if(this.isEnable){this.i.info("".concat(U," handler task start"));var n=F([],this.audioSourceList,!0),e=0,r=this.h.recvMode;if([t.ju.Team,t.ju.All].includes(r)){var o=this.getTeamAudioSourceGroup();n=o.otherList,o.teamList.forEach((function(t){e<i._maxPlayingQuantity&&(t.isPlaying||t.startPlayingAudio("play for team"),e++)}))}var s=[t.ju.World,t.ju.All].includes(r);s&&(n.forEach((function(t){t.distance=t.getDistanceFromListener(i.h)})),n.sort((function(t,i){return null===t.distance?1:null===i.distance||t.distance<i.distance?-1:t.distance>i.distance?1:0}))),n.forEach((function(n){var r=[t.UF.All,t.UF.World].includes(n.sendMode)&&null!==n.distance&&(null===i.h.recvRange||n.distance<=i.h.recvRange);if(s&&e<i._maxPlayingQuantity&&r)n.isPlaying||n.startPlayingAudio("play for range"),e++;else{var o="stop for mode or range. mode: ".concat(n.sendMode,", range: ").concat(n.distance," > ").concat(i.h.recvRange);n.stopPlayingAudio(o)}})),this.i.info(U+" playing quantity: ".concat(e,"."))}else this.stopPlayingAudioStream()},i.prototype.startCheckUserInRange=function(){this.i.info(U+" start user check"),this.updateUserTimer&&(clearTimeout(this.updateUserTimer),this.updateUserTimer=null),this.userChanged=!0,this.userCheckTask()},i.prototype.stopCheckUserInRange=function(){this.i.info(U+" stop user check"),this.updateUserTimer&&(clearTimeout(this.updateUserTimer),this.updateUserTimer=null)},i.prototype.userCheckTask=function(){var t=this;this.userChanged&&(this.userChanged=!1,this.handleUserCheckTask()),this.updateUserTimer=window.setTimeout((function(){t.userCheckTask()}),this.updateUserInterval)},i.prototype.handleUserCheckTask=function(){var t=this;if(this.audioSourceUpdate){var i=[];this.allAudioSourceList.forEach((function(n){n.distance=n.getDistanceFromListener(t.h);var e=null!==n.distance&&(null===t.h.recvRange||n.distance<=t.h.recvRange),r=!!t.localUserList.find((function(t){return t.userID===n.userID}));e&&r&&i.push({userID:n.userID,position:n.position})})),this.checkAudioSourceListDiff(i,this.audioSourceWithinRangeList)&&this.h.eventHandler.emit("audioSourceWithinRangeUpdate",i),this.audioSourceWithinRangeList=i}},i.prototype.getTeamAudioSourceGroup=function(){var t=this,i=[],n=[];return this.audioSourceList.forEach((function(e){e.isSpeakInTeam(t.h.teamID)?i.push(e):n.push(e)})),{teamList:i,otherList:n}},i.prototype.stopPlayingAudioStream=function(){this.timer&&(clearTimeout(this.timer),this.timer=null);this.audioSourceList.forEach((function(t){t.stopPlayingAudio("stop for all stream")}))},i.prototype.setLocalUserList=function(t){this.localUserList=t,this.userChanged=!0},i.prototype.checkAudioSourceListDiff=function(t,i){for(var n,e=0;e<t.length;e++){n=!1;for(var r=0;r<i.length;r++)if(t[e].userID===i[r].userID){n=!0;break}if(!n)return!0}for(var o=0;o<i.length;o++){n=!1;for(var s=0;s<t.length;s++)if(i[o].userID===t[s].userID){n=!0;break}if(!n)return!0}return!1},i}();function H(t){return!isNaN(Number(t))&&""!==t&&Number.MAX_SAFE_INTEGER>=Number(t)&&Number(t)>=-Number.MAX_SAFE_INTEGER}function z(t){if(Array.isArray(t)){for(var i=0;i<3;i++){if(!H(t[i]))return!1}return!0}return!1}!function(t){t[t.Normal=0]="Normal",t[t.Custom=1]="Custom"}(L||(L={}));var V=function(){return V=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var r in i=arguments[n])Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r]);return t},V.apply(this,arguments)},W=function(t,i,n,e){return new(n||(n=Promise))((function(r,o){function s(t){try{h(e.next(t))}catch(t){o(t)}}function u(t){try{h(e.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?r(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(s,u)}h((e=e.apply(t,i||[])).next())}))},J=function(t,i){var n,e,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,e&&(r=2&u[0]?e.return:u[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,u[1])).done)return r;switch(e=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,e=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){s.label=u[1];break}if(6===u[0]&&s.label<r[1]){s.label=r[1],r=u;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(u);break}r[2]&&s.ops.pop(),s.trys.pop();continue}u=i.call(t,s)}catch(t){u=[6,t],e=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},q=function(t,i,n){if(n||2===arguments.length)for(var e,r=0,o=i.length;r<o;r++)!e&&r in i||(e||(e=Array.prototype.slice.call(i,0,r)),e[r]=i[r]);return t.concat(e||Array.prototype.slice.call(i))};function B(){var t;return W(this,void 0,void 0,(function(){var i,n,e;return J(this,(function(r){switch(r.label){case 0:return(i=null===navigator||void 0===navigator?void 0:navigator.userAgentData)?[4,i.getHighEntropyValues(["platformVersion"]).catch((function(){}))]:[2,{platform:"",majorPlatformVersion:0}];case 1:return n=r.sent()||{},e=parseInt(null===(t=n.platformVersion)||void 0===t?void 0:t.split(".")[0]),[2,{platform:n.platform,majorPlatformVersion:e}]}}))}))}var Q="zc.ra.0";var Y=function(){function e(t,n){var e=this;this.i=n,this.isSpatial=!1,this.audioSourceList=[],this.audioSourceUpdate=!1,this.localUserList=[],this.speakingUserIdList=[],this.vocalSourceMap=new Map,this.volume=1,this.speaker="",this.l=null,this.supportSpeakerSet=!1,this.isHide=!1,this.eventHandler={visibilitychange:function(){return W(e,void 0,void 0,(function(){var t,n,e,r,o,s=this;return J(this,(function(u){switch(u.label){case 0:return q(q([],this.vocalSourceList,!0),this.audioSourceList,!0).forEach((function(t){t.inBackground(i.VJ.hidden),s.isHide=i.VJ.hidden})),t=function(){q(q([],s.vocalSourceList,!0),s.audioSourceList,!0).forEach((function(t){t.changeRenderConfig(s.isOpen3D(t),!0,!1,!1)}))},i.VJ.hidden?(n=(0,c.H8)()&&(0,c.Fr)(),[4,B()]):[3,2];case 1:return e=u.sent(),r="Windows"===e.platform&&e.majorPlatformVersion>=13,n||r?(this.i.warn("".concat(Q," mobile chrome hide page and stop web audio.")),t(),[2]):("running"!==(o=this.audioCtx.state)?(this.i.info("".concat(Q," hidden ctx: ").concat(o,", resume ctx")),this.audioCtx.resume(),setTimeout((function(){var i=s.audioCtx.state;s.isHide&&("running"===i?s.i.info("".concat(Q," hidden ctx: ").concat(i,".")):(s.i.warn("".concat(Q," hidden ctx: ").concat(i,", ctx resume failed. stop web audio.")),t()))}),2e3)):this.i.info("".concat(Q," hidden ctx: ").concat(o,".")),[3,3]);case 2:this.audioCtx.resume(),this.audioSourceList.forEach((function(t){var i,n;t.isPlaying&&(null===(i=t.audioEl)||void 0===i||i.dom.pause(),null===(n=t.audioEl)||void 0===n||n.dom.play().catch((function(){s.i.warn("".concat(Q," show page and  ").concat(t.userID," replay failed."))})))})),u.label=3;case 3:return[2]}}))}))}},this.zegoRTC=t,i.VJ.addEventListener("visibilitychange",this.eventHandler.visibilitychange,!1),this.zegoRTC.on("roomStreamUpdate",(function(t,i,n){var r=n.map((function(t){var i=e.getStreamInfo(t.extraInfo,t.streamID),n=i.isRangeAudioStream,r=i.teamID,o=i.raMode,s=i.sendMode;return V(V({},t),{isRangeAudioStream:n,teamID:r,raMode:o,sendMode:s})})).filter((function(t){return t.isRangeAudioStream})),o=r.map((function(t){return t.user.userID}));"DELETE"===i?e.speakingUserIdList=e.speakingUserIdList.filter((function(t){var i=!o.includes(t);if(!i){var n=e.audioSourceMap[t];if(n){n.stopPlayingAudio("stop for stream delete")}}return i})):"ADD"===i&&(e.speakingUserIdList=e.speakingUserIdList.concat(o),r.forEach((function(t){var i=t.user.userID,n=e.audioSourceMap[i],r=t.teamID,o=t.raMode,s=t.sendMode;if(n)n.streamID!==t.streamID&&(n.stopPlayingAudio("stop for old stream"),n.streamID=t.streamID),void 0!==o&&(n.raMode=o),r!==n.teamID&&(n.teamID=r),n.changeRenderConfig(e.isOpen3D(n));else{var u=new g(e.i,{userID:i,teamID:r,raMode:o,sendMode:s},{audioCtx:e.audioCtx,zegoRTC:e.zegoRTC,isSpatial:e.isSpatial,maxDistance:e.h.recvRange,volume:e.volume,speaker:e.speaker,isHide:e.isHide});u.streamID=t.streamID,e.audioSourceList.push(u),e.playStreamHandler.hasChanged=!0}}))),e.playStreamHandler.setAudioSourceList(e.speakingAudioSourceList)})),this.zegoRTC.on("playerStateUpdate",(function(t){var i=e.audioSourceList.find((function(i){return i.streamID===t.streamID}));i&&("NO_PLAY"===t.state?i.isPlaying=!1:("PLAYING"===t.state&&i.checkTrackChanged(),i.isPlaying=!0))})),this.zegoRTC.on("streamExtraInfoUpdate",(function(t,i){e.i.info(Q+" recv extra info: "+JSON.stringify(i));var n=!1;i.forEach((function(t){var i=e.audioSourceMap[t.user.userID];if(i&&i.streamID){var r=e.getStreamInfo(t.extraInfo,t.streamID),o=r.teamID,s=r.raMode,u=r.sendMode;o!==i.teamID&&(i.teamID=o,n=!0),void 0!==s&&(i.raMode=s,n=!0),i.sendMode!==u&&(i.sendMode=u,n=!0),e.playStreamHandler.hasChanged=!0}})),n&&e.enableSpatializer(e.isSpatial)})),this.zegoRTC.RTM._on("_roomStateUpdate",(function(t,i){"CONNECTED"===i?(e.roomID=t,e.h.userID=e.zegoRTC.RTM.getUserID(),e.playStreamHandler.hasChanged=!0,e.playStreamHandler.userChanged=!0):"DISCONNECTED"===i&&(e.roomID=void 0,e.h.reset(),e.enableSpeaker(!1),e.audioSourceList=[],e.playStreamHandler.setAudioSourceList([]),e.localUserList=[],e.playStreamHandler.setLocalUserList([]))})),this.zegoRTC.RTM.on("roomUserUpdate",(function(t,i,n){var r;e.i.info(Q+" roomUserUpdate: ",t,i,JSON.stringify(n)),"ADD"===i?(r=e.localUserList).push.apply(r,n):"DELETE"===i&&n.forEach((function(t){e.localUserList=e.localUserList.filter((function(i){return i.userID!==t.userID}))})),e.playStreamHandler.setLocalUserList(e.localUserList)})),this.zegoRTC.on("publishQualityUpdate",(function(t,i){var n=t.match(/(.*)_(.*)/);if(3===(null==n?void 0:n.length)){var r=n[1];if(e.h.userID!==r)return;var o=V({},i.audio);e.eventManager.emit("publishQualityUpdate",r,o)}})),this.zegoRTC.on("playQualityUpdate",(function(t,i){var n,r=t.match(/(.*)_(.*)/);if(3===(null==r?void 0:r.length)){var o=r[1],s=i.audio,u=i.peerToPeerDelay,h=i.peerToPeerPacketLostRate;if(!(null===(n=e.audioSourceList)||void 0===n?void 0:n.some((function(t){return t.userID===o}))))return;var a=V(V({},s),{peerToPeerDelay:u,peerToPeerPacketLostRate:h});e.eventManager.emit("playQualityUpdate",o,a)}})),this.l=this.p(),this.h=j.getInstance(this.audioCtx,this.zegoRTC),this.playStreamHandler=G.getInstance(this.i,this.h),this.eventManager=I.getInstance()}return Object.defineProperty(e.prototype,"audioSourceMap",{get:function(){return this.audioSourceList.reduce((function(t,i){return i.userID&&(t[i.userID]=i),t}),{})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"speakingAudioSourceList",{get:function(){var t=this;return this.audioSourceList.filter((function(i){return t.speakingUserIdList.includes(i.userID)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vocalSourceList",{get:function(){for(var t=[],i=this.vocalSourceMap.values(),n=0;n<this.vocalSourceMap.size;n++)t.push(i.next().value);return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playingAudioSourceList",{get:function(){return this.audioSourceList.filter((function(t){return t.isPlaying}))},enumerable:!1,configurable:!0}),e.prototype.p=function(){var t=this,i=new(window.AudioContext||window.webkitAudioContext);return i.addEventListener("statechange",(function(){"suspended"===i.state&&(t.i.info(Q+" audio context suspended"),i.resume())})),i},Object.defineProperty(e.prototype,"audioCtx",{get:function(){return this.l||(this.l=this.p()),this.l},enumerable:!1,configurable:!0}),e.getInstance=function(t,i){return e.instance||(e.instance=new e(t,i)),e.instance},e.prototype.resumeAudioContext=function(){return W(this,void 0,void 0,(function(){var t=this;return J(this,(function(e){return[2,new i.l3((function(i){n.generateEls(),"running"===t.audioCtx.state&&i(!0),t.audioCtx.onstatechange=function(){"running"===t.audioCtx.state&&i(!0)},t.audioCtx.resume(),t.i.info(Q+" resume audio ctx"),setTimeout((function(){i(!1)}),3e3)}))]}))}))},e.prototype.getAudioContextState=function(){return this.audioCtx.state},e.prototype.getStreamInfo=function(t,i){var n=void 0,e=null;try{e=JSON.parse(t)}catch(t){return this.i.warn(Q+" parse room extra info failed. ".concat(i," is not ra stream.")),{isRangeAudioStream:!1}}if(!e.hasOwnProperty("range_audio_team_id")||!e.hasOwnProperty("range_audio_mode"))return this.i.warn(Q+" extra info has no mode. ".concat(i," is not ra stream.")),{isRangeAudioStream:!1};n={1:0,2:1,3:2}[e.range_audio_mode];var r=e.r_a_s_flag,o={teamID:e.range_audio_team_id||void 0,raMode:n,isRangeAudioStream:void 0===r||1===r};return e.hasOwnProperty("r_a_speak")&&(o.sendMode=e.r_a_speak),this.i.info("".concat(Q," ").concat(i," parse extra info: ").concat(JSON.stringify(o),".")),o},e.prototype.setAudioReceiveRange=function(t){if(!H(t))throw Error("Failed to execute 'setAudioReceiveRange': Argument 'range' requires to be type number.");if(t=Number(t),(t=Number(t))<0)throw Error("Failed to execute 'setAudioReceiveRange': Argument 'range' can not be less than 0.");this.i.info(Q+" set receive range: "+t),this.h.recvRange=t,this.audioSourceList.forEach((function(i){i.setMaxDistance(t)})),this.playStreamHandler.hasChanged=!0,this.playStreamHandler.userChanged=!0},e.prototype.updateSelfPosition=function(t,i,n,e){var r=this,o=function(t){return"Failed to execute 'updateSelfPosition': Argument '".concat(t,"' requires an array of type number.\"")};if(!z(t))throw new Error(o("position"));if(!z(i))throw new Error(o("axisForward"));if(!z(n))throw new Error(o("axisRight"));if(!z(e))throw new Error(o("axisUp"));this.i.info(Q+" set self position [".concat(t,"]")),this.h&&(this.h.updateSelfPosition(t,i,e),this.vocalSourceMap.forEach((function(t){t.checkIfCanPlay(r.h)}))),this.playStreamHandler.setListener(this.h)},e.prototype.updateAudioSource=function(t,i){if(t=String(t),!z(i))throw new Error("Failed to execute 'updateAudioSource': parameter 'position' must be an array of type number.");var n=this.audioSourceMap[t];n?n.setPosition(i):(n=new g(this.i,{userID:t,position:i},{audioCtx:this.audioCtx,zegoRTC:this.zegoRTC,isSpatial:this.isSpatial,maxDistance:this.h.recvRange,volume:this.volume,speaker:this.speaker,isHide:this.isHide}),this.enableSpatializer(this.isSpatial),this.audioSourceList.push(n)),this.playStreamHandler.setAudioSourceList(this.speakingAudioSourceList),this.playStreamHandler.setAllAudioSourceList(this.audioSourceList)},e.prototype.enableMicrophone=function(t){if(void 0===t&&(t=!0),!this.h.userID)throw new Error("Enable mic failed. Please log in room first.");return t?this.h.startPublishingStream():this.h.stopPublishingStream()},e.prototype.selectMic=function(t){return W(this,void 0,void 0,(function(){var i,n,e,r;return J(this,(function(o){switch(o.label){case 0:if(!(0,a.QP)(t)&&!(0,a.TE)(t))throw new Error("Select mic failed. DeviceID error.");if(n=(i=this.h).audioStream,e=i.isPublishing,this.i.info(Q+" select mic: "+t),!n||!e)return[3,5];r={errorCode:0},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.zegoRTC.useAudioDevice(n,t||"")];case 2:return r=o.sent(),[3,4];case 3:return o.sent(),[2,!1];case 4:return 0===r.errorCode?(this.h.micID=t,[2,!0]):[2,!1];case 5:return this.h.micID=t,[2,!0];case 6:return[2]}}))}))},e.prototype.enableSpeaker=function(t){if(void 0===t&&(t=!0),t&&!this.roomID)throw new Error("Enable speaker failed. Please log in room first.");this.playStreamHandler.isEnable=t,this.i.info(Q+" enable speaker: "+t),t?(n.generateEls(),this.playStreamHandler.startPlayingAudioStream()):this.playStreamHandler.stopPlayingAudioStream()},e.prototype.enableSpatializer=function(t){var i=this;void 0===t&&(t=!0),this.i.info(Q+" set spatializer: "+t),this.isSpatial=!!t,this.audioSourceList.forEach((function(t){t.changeRenderConfig(i.isOpen3D(t))})),this.vocalSourceList.forEach((function(i){i.changeRenderConfig(t)})),t&&this.h.updateListenerEffect()},e.prototype.enableAiDenoise=function(t){if(this.i.info(Q+" set ai denoise: "+t),!(0,a.dd)(t))return!1;var i=(0,c.Fr)();return(i||window.AudioWorklet)&&window.WebAssembly&&(window.AudioContext||(null===window||void 0===window?void 0:window.webkitAudioContext)).prototype.createScriptProcessor?this.h.enableDenoise(!!t):(this.i.error(Q+"".concat(i&&" mobile"," browser dose not support ai denoise.")),!1)},e.prototype.setAiDenoiseMode=function(t){return void 0===t&&(t=C.PP.AI),this.h.setAiDenoiseMode(t)},e.prototype.setVoiceChangerPreset=function(t){this.i.info(Q+" set voice changer preset: "+JSON.stringify(t));var i=(0,c.Fr)();return(i||window.AudioWorklet)&&window.WebAssembly&&(window.AudioContext||(null===window||void 0===window?void 0:window.webkitAudioContext)).prototype.createScriptProcessor?this.h.setVoiceChangerPreset(t):(this.i.error(Q+"".concat(i&&" mobile"," browser dose not support voice changer.")),!1)},e.prototype.setRangeAudioTeamID=function(t){this.i.info(Q+" set team id: "+t),this.h.setTeamID(t),this.enableSpatializer(this.isSpatial),this.playStreamHandler.hasChanged=!0},e.prototype.setRangeAudioMode=function(t){if(this.modeType===L.Custom)throw new Error("Failed to execute 'setRangeAudioMode': already use 'setRangeAudioCustomMode'.");this.modeType=L.Normal,this.i.info(Q+" set mode "+t),this.h.setNormalMode(t),this.playStreamHandler.hasChanged=!0},e.prototype.setCustomMode=function(t,i){if(this.modeType===L.Normal)throw new Error("Failed to execute 'setRangeAudioCustomMode': already use 'setRangeAudioMode'.");this.modeType=L.Custom,this.i.info(Q+" set custom mode: ".concat(t,", ").concat(i));var n=this.h.setCustomMode(t,i).recvChange;this.playStreamHandler.hasChanged=!0,n&&this.enableSpatializer(this.isSpatial)},e.prototype.setAudioVolume=function(t){var i=this;if(this.i.info(Q+" set volume ".concat(t)),t<0)throw new Error("Failed to execute 'setVolume': The volume provided is outside the range [0, 200].");this.volume=t/100,this.audioSourceList.forEach((function(t){t.setVolume(i.volume)}))},e.prototype.selectSpeaker=function(t){var n=this;if(void 0===t&&(t=""),!(0,a.QP)(t))throw new Error("Select speaker failed. Device ID error.");if(!this.supportSpeakerSet){if(!!!i.VJ.createElement("audio").setSinkId)throw new Error("Failed to execute 'selectSpeaker': browser not support.");this.supportSpeakerSet=!0}this.speaker=t,this.i.info(Q+" set speaker: "+t),""===t&&this.i.warn(Q+" set speaker to be default. ");this.audioSourceList.find((function(i){return W(n,void 0,void 0,(function(){var n;return J(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,i.setSpeaker(t)];case 1:return e.sent(),[3,3];case 2:return n=e.sent(),this.i.warn(Q+" set speaker failed. id: ".concat(t,", error: ").concat(n)),[2,!0];case 3:return[2,!1]}}))}))}))},e.prototype.setPositionUpdateFrequency=function(t){if(!(t>=15))throw new Error("Failed to execute 'setPositionUpdateFrequency': The frequency provided is outside the range [15, +].");this.playStreamHandler.interval=Number(t)||100,this.i.info(Q+" set interval: "+t)},e.prototype.on=function(t,i){return this.eventManager.addEventHandler(t,i)},e.prototype.off=function(t,i){return this.eventManager.removeEventHandler(t,i)},e.prototype.enableAudioSourceUpdateChecker=function(t,i){if(this.i.info(Q+" set source update: "+t),this.audioSourceUpdate=t,this.playStreamHandler.setAudioSourceUpdate(t),i&&(0,a.Cs)(i.frequency)){if(i.frequency<50)throw new Error("Failed to execute 'enableAudioSourceUpdateChecker': The frequency provided is outside the range [50, +].");this.playStreamHandler.updateUserInterval=Number(i.frequency)||1e3,this.i.info(Q+" set interval: "+i.frequency)}t?this.playStreamHandler.startCheckUserInRange():this.playStreamHandler.stopCheckUserInRange()},e.prototype.getVocalSource=function(t,i){var n=this.vocalSourceMap.get(t);if(!n){var e={audioCtx:this.audioCtx,isSpatial:this.isSpatial,maxDistance:i||0,volume:this.volume,speaker:this.speaker,isHide:this.isHide};n=(0,a.Si)(t)?new O(this.i,{media:t},e):new R(this.i,{streamView:t},e)}return this.vocalSourceMap.set(t,n),n},e.prototype.setStreamVocalRange=function(t,i){var n=(0,a.Si)(t);if(!n&&!(null==t?void 0:t.v))throw new Error("Failed to execute 'setVocalRange': type of parameter 1 error.");if(!H(i))throw Error("Failed to execute 'setVocalRange': parameter 2 requires to be type number.");i=Number(i),this.i.info(Q+" ".concat(n?"custom":"stream"," set range: ")+i);var e=this.getVocalSource(t,i);e.setMaxDistance(i),e.checkIfCanPlay(this.h)},e.prototype.updateStreamPosition=function(t,i){if(!(0,a.Si)(t)&&!(null==t?void 0:t.v))throw new Error("Failed to execute 'updatePosition': type of parameter 1 error.");if(!z(i))throw new Error("Failed to execute 'updatePosition': parameter 'position' must be an array of type number.");var n=this.getVocalSource(t);n.setPosition(i),n.checkIfCanPlay(this.h)},e.prototype.isOpen3D=function(i){return i instanceof g?(!(this.h.recvMode!==t.ju.World)||!i.isSpeakInTeam(this.h.teamID))&&this.isSpatial:this.isSpatial},e}(),K=function(t,i,n,e){return new(n||(n=Promise))((function(r,o){function s(t){try{h(e.next(t))}catch(t){o(t)}}function u(t){try{h(e.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?r(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(s,u)}h((e=e.apply(t,i||[])).next())}))},$=function(t,i){var n,e,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,e&&(r=2&u[0]?e.return:u[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,u[1])).done)return r;switch(e=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,e=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){s.label=u[1];break}if(6===u[0]&&s.label<r[1]){s.label=r[1],r=u;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(u);break}r[2]&&s.ops.pop(),s.trys.pop();continue}u=i.call(t,s)}catch(t){u=[6,t],e=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},X=function(){function t(t,i){this.m=Y.getInstance(t,i)}return t.getInstance=function(i,n){if(!t.instance){if(!i)throw Error("create instance failed.");t.instance=new t(i,n)}return t.instance},t.prototype.enableAiDenoise=function(t){return this.m.enableAiDenoise(t)},t.prototype.setAiDenoiseMode=function(t){return this.m.setAiDenoiseMode(t)},t.prototype.enableAudioSourceUpdateChecker=function(t,i){this.m.enableAudioSourceUpdateChecker(t,i)},t.prototype.on=function(t,i){return this.m.on(t,i)},t.prototype.off=function(t,i){return this.m.off(t,i)},t.prototype.setAudioReceiveRange=function(t){this.m.setAudioReceiveRange(t)},t.prototype.updateSelfPosition=function(t,i,n,e){this.m.updateSelfPosition(t,i,n,e)},t.prototype.updateAudioSource=function(t,i){this.m.updateAudioSource(t,i)},t.prototype.enableSpatializer=function(t){return this.m.enableSpatializer(t)},t.prototype.enableMicrophone=function(t){return this.m.enableMicrophone(t)},t.prototype.selectMicrophone=function(t){return K(this,void 0,void 0,(function(){return $(this,(function(i){switch(i.label){case 0:return[4,this.m.selectMic(t)];case 1:return[2,i.sent()]}}))}))},t.prototype.selectSpeaker=function(t){return this.m.selectSpeaker(t)},t.prototype.enableSpeaker=function(t){return this.m.enableSpeaker(t)},t.prototype.setRangeAudioCustomMode=function(t,i){this.m.setCustomMode(t,i)},t.prototype.setRangeAudioMode=function(t){this.m.setRangeAudioMode(t)},t.prototype.setTeamID=function(t){this.m.setRangeAudioTeamID(t)},t.prototype.setPositionUpdateFrequency=function(t){return this.m.setPositionUpdateFrequency(t)},t.prototype.setRangeAudioVolume=function(t){return this.m.setAudioVolume(t)},t.prototype.setVoiceChangerPreset=function(t){return this.m.setVoiceChangerPreset({voiceChanger:t})},t.prototype.setVoiceChangerParam=function(t){return this.m.setVoiceChangerPreset({voiceParam:t})},t.prototype.isAudioContextRunning=function(){return"running"===this.m.getAudioContextState()},t.prototype.resumeAudioContext=function(){return this.m.resumeAudioContext()},t.prototype.setStreamVocalRange=function(t,i){this.m.setStreamVocalRange(t,i)},t.prototype.updateStreamPosition=function(t,i){this.m.updateStreamPosition(t,i)},t.prototype.setCustomSourceVocalRange=function(t,i){this.m.setStreamVocalRange(t,i)},t.prototype.updateCustomSourcePosition=function(t,i){this.m.updateStreamPosition(t,i)},t}(),Z={type:"RangeAudio",install:function(t){Object.defineProperty(t.prototype,"createRangeAudioInstance",{value:function(){return this.rangeAudio||(this.rangeAudio=X.getInstance(this,this.logger)),this.rangeAudio},writable:!1})}}}(),r}()}));